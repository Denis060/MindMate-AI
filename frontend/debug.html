<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindMate AI - Debug Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: 0 auto; }
        .hidden { display: none; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, textarea { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { background-color: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background-color: #0056b3; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        #result-view { margin-top: 20px; padding: 15px; background-color: #e8f6f3; border-left: 5px solid #1abc9c; border-radius: 4px; }
        #error-container { margin-top: 20px; padding: 15px; background-color: #fbeee6; border-left: 5px solid #e74c3c; border-radius: 4px; }
        .loader { display: inline-block; width: 16px; height: 16px; border: 2px solid #f3f3f3; border-top: 2px solid #007bff; border-radius: 50%; animation: spin 1s linear infinite; margin-left: 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <h1>MindMate AI - Debug Test</h1>
    
    <form id="symptom-form">
        <div class="form-group">
            <label for="name">Name</label>
            <input type="text" id="name" name="name" placeholder="Your name" required>
        </div>
        <div class="form-group">
            <label for="age">Age</label>
            <input type="number" id="age" name="age" placeholder="Your age" required min="1">
        </div>
        <div class="form-group">
            <label for="symptoms">Describe how you're feeling</label>
            <textarea id="symptoms" name="symptoms" rows="4" placeholder="Describe your symptoms..." required></textarea>
        </div>
        <button type="submit" id="submit-btn">
            <span class="button-text">Get Recommendation</span>
            <span class="loader hidden"></span>
        </button>
    </form>

    <div id="result-view" class="hidden">
        <div id="response-container">
            <h2>Recommendation</h2>
            <p id="response-message"></p>
        </div>
        <button type="button" id="new-submission-btn">New Submission</button>
    </div>

    <div id="error-container" class="hidden">
        <h2>Error</h2>
        <p id="error-message"></p>
    </div>

    <div id="debug-info">
        <h3>Debug Information</h3>
        <div id="debug-log"></div>
    </div>

    <script>
        const debugLog = document.getElementById('debug-log');
        const log = (message) => {
            console.log(message);
            debugLog.innerHTML += `<div>${new Date().toLocaleTimeString()}: ${message}</div>`;
        };

        document.addEventListener('DOMContentLoaded', () => {
            log('Script loaded!');
            
            // DOM Element References
            const symptomForm = document.getElementById('symptom-form');
            const submitButton = document.getElementById('submit-btn');
            const buttonText = submitButton.querySelector('.button-text');
            const buttonLoader = submitButton.querySelector('.loader');
            const resultView = document.getElementById('result-view');
            const responseMessage = document.getElementById('response-message');
            const errorContainer = document.getElementById('error-container');
            const errorMessage = document.getElementById('error-message');
            const newSubmissionButton = document.getElementById('new-submission-btn');
            
            log(`DOM elements found: form=${!!symptomForm}, button=${!!submitButton}, resultView=${!!resultView}`);
            
            const BACKEND_URL = 'http://127.0.0.1:5000';

            const showLoader = () => {
                buttonText.textContent = 'Analyzing...';
                buttonLoader.classList.remove('hidden');
                submitButton.disabled = true;
                log('Loader shown');
            };

            const hideLoader = () => {
                buttonText.textContent = 'Get Recommendation';
                buttonLoader.classList.add('hidden');
                submitButton.disabled = false;
                log('Loader hidden');
            };

            const handleFormSubmit = async (event) => {
                event.preventDefault();
                log('Form submitted!');
                
                showLoader();

                const formData = new FormData(symptomForm);
                const name = formData.get('name');
                const age = formData.get('age');
                const symptoms = formData.get('symptoms');
                
                log(`Form data: name=${name}, age=${age}, symptoms=${symptoms.substring(0, 50)}...`);
                
                try {
                    log('Making API request...');
                    const response = await fetch(`${BACKEND_URL}/analyze`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ name, age, symptoms }),
                    });

                    log(`Response status: ${response.status}`);

                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        throw new Error(errorData.error || `HTTP error! Status: ${response.status}`);
                    }

                    const result = await response.json();
                    log(`API Response: ${JSON.stringify(result).substring(0, 100)}...`);
                    
                    if (result.status === 'success') {
                        log('Success! Showing result view...');
                        
                        responseMessage.textContent = result.message;
                        resultView.classList.remove('hidden');
                        symptomForm.classList.add('hidden');
                        
                        log('Result view should now be visible');
                    } else {
                        throw new Error(result.message || 'An unknown application error occurred.');
                    }

                } catch (error) {
                    log(`Error occurred: ${error.message}`);
                    errorMessage.textContent = `Error: ${error.message}`;
                    errorContainer.classList.remove('hidden');
                } finally {
                    hideLoader();
                }
            };

            const handleNewSubmission = () => {
                log('New submission clicked');
                resultView.classList.add('hidden');
                errorContainer.classList.add('hidden');
                symptomForm.reset();
                symptomForm.classList.remove('hidden');
            };

            symptomForm.addEventListener('submit', handleFormSubmit);
            newSubmissionButton.addEventListener('click', handleNewSubmission);
            
            log('Event listeners attached');
        });
    </script>
</body>
</html>
